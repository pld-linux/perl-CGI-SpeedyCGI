diff -urN CGI-SpeedyCGI-2.22.org/src/mod_speedycgi2.c CGI-SpeedyCGI-2.22/src/mod_speedycgi2.c
--- CGI-SpeedyCGI-2.22.org/src/mod_speedycgi2.c	2003-10-07 06:03:48.000000000 +0200
+++ CGI-SpeedyCGI-2.22/src/mod_speedycgi2.c	2006-06-06 12:55:35.563016823 +0200
@@ -340,7 +340,8 @@
     const char *buf;
     apr_size_t len;
     apr_status_t rv;
-    APR_BRIGADE_FOREACH(e, bb) {
+    e = APR_BRIGADE_FIRST(bb);
+    while (e != APR_BRIGADE_SENTINEL(bb)) {
         if (APR_BUCKET_IS_EOS(e)) {
             break;
         }
@@ -348,6 +349,7 @@
         if (rv != APR_SUCCESS) {
             break;
         }
+	e = APR_BUCKET_NEXT(e);
     }
 }
 
@@ -465,7 +467,8 @@
             return rv;
         }
 
-        APR_BRIGADE_FOREACH(bucket, bb) {
+	bucket = APR_BRIGADE_FIRST(bb);
+	while (bucket != APR_BRIGADE_SENTINEL(bb)) {
             const char *data;
             apr_size_t len;
 
@@ -476,11 +479,13 @@
 
             /* We can't do much with this. */
             if (APR_BUCKET_IS_FLUSH(bucket)) {
+		bucket = APR_BUCKET_NEXT(bucket);
                 continue;
             }
 
             /* If the child stopped, we still must read to EOS. */
             if (child_stopped_reading) {
+		bucket = APR_BUCKET_NEXT(bucket);
                 continue;
             } 
 
@@ -496,6 +501,7 @@
                 /* silly script stopped reading, soak up remaining message */
                 child_stopped_reading = 1;
             }
+	    bucket = APR_BUCKET_NEXT(bucket);
         }
         apr_brigade_cleanup(bb);
     }
